{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorksTeamWear | Jersey Designer</title>
    
    <!-- React T-Shirt Designer CSS -->
    <link rel="stylesheet" crossorigin href="{% static 'react-designer/assets/index-CVYrp-dY.css' %}">
    
    <!-- Bootstrap for navbar consistency -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <style>
        /* Override any development-specific styles */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        #root {
            width: 100%;
            height: calc(100vh - 80px); /* Adjust for navbar height */
        }

        /* Navbar styles from customer_base.html */
        .navbar-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 30px;
            width: 100%;
            gap: 40px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .navbar-left {
            flex: 0 0 auto;
            min-width: 200px;
        }

        .navbar-middle {
            flex: 1;
            display: flex;
            justify-content: center;
            max-width: 600px;
        }

        .navbar-right {
            flex: 0 0 auto;
            min-width: 200px;
            display: flex;
            justify-content: flex-end;
        }

        .nav-links {
            display: flex;
            align-items: center;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 15px;
        }

        .nav-links .upper-links {
            margin: 0;
        }

        .navbar-brand-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-decoration: none;
        }

        .navbar-brand-text:hover {
            color: #007bff;
            text-decoration: none;
        }

        .links {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            font-size: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .links:hover {
            color: #007bff;
            text-decoration: none;
            background-color: #f8f9fa;
        }

        .cart-button {
            position: relative;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .cart-svg {
            fill: #333;
        }

        .item-number {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            min-width: 18px;
            text-align: center;
        }

        /* Dropdown styles */
        .dropdown-menu {
            min-width: 250px;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
        }

        .item-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-badge.pending {
            background: #ffc107;
            color: #000;
        }

        .status-badge.receiving {
            background: #17a2b8;
            color: white;
        }

        .status-badge.cancelled {
            background: #dc3545;
            color: white;
        }

        .status-badge.delivered {
            background: #28a745;
            color: white;
        }

        /* Responsive adjustments */
        @media screen and (max-width: 768px) {
            .navbar-container {
                flex-direction: column;
                padding: 10px 20px;
            }
            
            .navbar-middle {
                order: 3;
                margin-top: 10px;
                width: 100%;
            }
            
            .navbar-right {
                order: 2;
                margin-top: 10px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="flex flex-col h-screen">
        <!-- Navigation from customer_base.html -->
        <div id="navbar">
            <div class="container">
                <div class="navbar-container">
                    <!-- Left Section: Brand Text -->
                    <div class="navbar-left">
                        <a href="/customer-home" class="navbar-brand-text">WorkTeamWear</a>
                    </div>
                    
                    <!-- Middle Section: Navigation Links -->
                    <div class="navbar-middle">
                        <ul class="nav-links">
                            <li class="upper-links"><a class="links" href="/customer-home">Home</a></li>
                            <li class="upper-links"><a class="links" href="{% url 'my-order' %}">Track Orders</a></li>
                            <li class="upper-links"><a class="links" href="/wishlist">Wishlist</a></li>
                            <li class="upper-links"><a class="links" href="/jersey-designer">3D Designer</a></li>
                            <li class="upper-links"><a class="links" href="/about">About Us</a></li>
                        </ul>
                    </div>
                    
                    <!-- Right Section: Cart, Profile, and Logout -->
                    <div class="navbar-right">
                        <ul class="nav-links">
                            <li class="upper-links">
                                <a class="links cart-button" href="/cart">
                                    <svg class="cart-svg" width="16" height="16" viewBox="0 0 16 16">
                                        <path d="M15.32 2.405H4.887C3 2.405 2.46.805 2.46.805L2.257.21C2.208.085 2.083 0 1.946 0H.336C.1 0-.064.24.024.46l.644 1.945L3.11 9.767c.047.137.175.23.32.23h8.418l-.493 1.958H3.768l.002.003c-.017 0-.033-.003-.05-.003-1.06 0-1.92.86-1.92 1.92s.86 1.92 1.92 1.92c.99 0 1.805-.75 1.91-1.712l5.55.076c.12.922.91 1.636 1.867 1.636 1.04 0 1.885-.844 1.885-1.885 0-.866-.584-1.593-1.38-1.814l2.423-8.832c.12-.433-.206-.86-.655-.86" fill="#333"></path>
                                    </svg>
                                    <span class="item-number">{{ product_count_in_cart|default:0 }}</span>
                                </a>
                            </li>
                            <li class="upper-links"><a class="links" href="/my-profile">Profile</a></li>
                            <li class="upper-links">
                                {% if user.is_authenticated %}
                                    <form method="post" action="{% url 'logout' %}" style="margin: 0; padding: 0;">
                                        {% csrf_token %}
                                        <button type="submit" class="links" style="background: none; border: none; padding: 8px 12px; margin: 0; font-weight: 500; font-size: 15px; color: #333; border-radius: 4px; transition: all 0.3s ease;">Logout</button>
                                    </form>
                                {% else %}
                                    <a class="links" href="{% url 'customerlogin' %}">Login</a>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- React App Container -->
        <div id="root" class="flex-1"></div>
    </div>

    <!-- Custom integration script - MUST be loaded before React app -->
    <script>
        // Set up Django configuration for React
        window.DJANGO_CONFIG = {
            staticUrl: '{% get_static_prefix %}',
            csrfToken: '{{ csrf_token }}'
        };
        
        // Set base path for React assets
        window.__PUBLIC_PATH__ = '{% get_static_prefix %}react-designer/';
        window.__REACT_DESIGNER_BASE_PATH__ = '{% get_static_prefix %}react-designer/';
        
        // Disable Vite client in production
        window.__vite_is_modern_browser = false;
        window.importMeta = { env: { PROD: true } };
        
        console.log('Setting up request interception...');
        
        // Override XMLHttpRequest and fetch to redirect 3D model requests
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            console.log('Fetch called with URL:', url);
            if (typeof url === 'string' && (url.includes('3Dmodels/') || url.includes('.glb'))) {
                console.log('Intercepting fetch request:', url);
                // Handle both absolute and relative paths that resolve to current page
                if (url.includes('/react-tshirt-designer/3Dmodels/')) {
                    const filename = url.split('/').pop();
                    const modelPath = url.includes('textures/') ? 
                        '3Dmodels/textures/' + filename : 
                        '3Dmodels/' + filename;
                    url = '{% get_static_prefix %}react-designer/' + modelPath;
                } else if (url.includes('3Dmodels/')) {
                    const filename = url.split('/').pop();
                    const modelPath = url.includes('textures/') ? 
                        '3Dmodels/textures/' + filename : 
                        '3Dmodels/' + filename;
                    url = '{% get_static_prefix %}react-designer/' + modelPath;
                }
                console.log('Redirected to:', url);
            }
            return originalFetch.call(this, url, options);
        };

        // Also override XMLHttpRequest for Three.js loaders
        const originalXHROpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url, ...args) {
            console.log('XHR open called with URL:', url);
            if (typeof url === 'string' && (url.includes('3Dmodels/') || url.includes('.glb'))) {
                console.log('Intercepting XHR request:', url);
                if (url.includes('/react-tshirt-designer/3Dmodels/')) {
                    const filename = url.split('/').pop();
                    const modelPath = url.includes('textures/') ? 
                        '3Dmodels/textures/' + filename : 
                        '3Dmodels/' + filename;
                    url = '{% get_static_prefix %}react-designer/' + modelPath;
                } else if (url.includes('3Dmodels/')) {
                    const filename = url.split('/').pop();
                    const modelPath = url.includes('textures/') ? 
                        '3Dmodels/textures/' + filename : 
                        '3Dmodels/' + filename;
                    url = '{% get_static_prefix %}react-designer/' + modelPath;
                }
                console.log('XHR Redirected to:', url);
            }
            return originalXHROpen.call(this, method, url, ...args);
        };

        // Wait for React to load, then override Three.js loaders
        function checkForThreeJS() {
            console.log('Checking for THREE.js...');
            if (window.THREE && window.THREE.FileLoader) {
                console.log('THREE.js found, setting up FileLoader override...');
                const originalLoad = window.THREE.FileLoader.prototype.load;
                window.THREE.FileLoader.prototype.load = function(url, onLoad, onProgress, onError) {
                    console.log('THREE.FileLoader load called with URL:', url);
                    if (typeof url === 'string' && (url.includes('3Dmodels/') || url.includes('.glb'))) {
                        console.log('Intercepting THREE.FileLoader request:', url);
                        if (url.includes('/react-tshirt-designer/3Dmodels/')) {
                            const filename = url.split('/').pop();
                            const modelPath = url.includes('textures/') ? 
                                '3Dmodels/textures/' + filename : 
                                '3Dmodels/' + filename;
                            url = '{% get_static_prefix %}react-designer/' + modelPath;
                        } else if (url.includes('3Dmodels/')) {
                            const filename = url.split('/').pop();
                            const modelPath = url.includes('textures/') ? 
                                '3Dmodels/textures/' + filename : 
                                '3Dmodels/' + filename;
                            url = '{% get_static_prefix %}react-designer/' + modelPath;
                        }
                        console.log('THREE.FileLoader Redirected to:', url);
                    }
                    return originalLoad.call(this, url, onLoad, onProgress, onError);
                };
            } else {
                console.log('THREE.js not found yet, will try again...');
                setTimeout(checkForThreeJS, 1000);
            }
        }
        setTimeout(checkForThreeJS, 1000);
    </script>
    
    <!-- Bootstrap JavaScript for dropdown functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- React T-Shirt Designer JavaScript -->
    <script type="module" crossorigin src="{% static 'react-designer/assets/index-Vvv8ZYE_.js' %}?v={{ request.GET.ide_webview_request_time|default:'1' }}"></script>
</body>
</html>
